<?xml version="1.0" encoding="UTF-8"?>
    <api context="/phones" name="PhoneVerifyAPI" xmlns="http://ws.apache.org/ns/synapse">
	<resource methods="GET" uri-template="/validate/{phoneNumber}">
		<inSequence>
			<property name="Property" scope="default" type="STRING" expression="get-property('uri.var.phoneNumber')" description="Read the phone number in the resource URL"/>
			<log category="INFO" level="custom" separator="," description="Log the phone number">
				<property name="PhoneNumber" value="$ctx:phoneNumber"/>
			</log>
			<filter description="Check phone number has 10 digits" xpath="fn:string-length($ctx:phoneNumber) = 10">
				<then>
					<call description="Send request to endpoint">
						<endpoint key="PhoneVerifyEP"/>
					</call>
				</then>
				<else>
					<payloadFactory description="Create response payload for invalid phone numbers" media-type="xml" template-type="default">
						<format>
							<Message>Invalid Phone Number</Message>
						</format>
						<args>
						</args>
					</payloadFactory>
				</else>
			</filter>
			<respond description="Send response back to the client"/>
		</inSequence>
		<faultSequence>
		</faultSequence>
	</resource>
</api>